---
interface HistoryPoint {
  year: number;
  value: number;
}

interface Details {
  chartType?: string;
  chartLabel?: string;
  history?: HistoryPoint[];
}

interface Props {
  id: string;
  label: string;
  value: string | number;
  unit?: string;
  description?: string;
  change?: number;
  source?: string;
  highlight?: boolean;
  details?: Details;
}

const { id, label, value, unit, description, change, source, highlight = false, details } = Astro.props;

const hasDetails = details && details.history && details.history.length > 0;
---

<article 
  class:list={[
    'stat-card relative bg-white border rounded-lg p-6 transition-all duration-300 overflow-hidden',
    highlight ? 'border-czech-blue bg-gradient-to-br from-white to-gray-50' : 'border-gray-200',
    hasDetails ? 'hover:shadow-lg hover:-translate-y-0.5 cursor-pointer border-l-4 border-l-blue-400' : ''
  ]}
  data-stat-id={id}
  data-stat-label={label}
  data-stat-value={value}
  data-stat-unit={unit || ''}
  data-stat-description={description || ''}
  data-stat-change={change !== undefined ? change : ''}
  data-stat-source={source || ''}
  data-stat-details={details ? JSON.stringify(details) : ''}
  data-has-details={hasDetails ? 'true' : 'false'}
  role={hasDetails ? 'button' : undefined}
  tabindex={hasDetails ? 0 : undefined}
>
  <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">
    {label}
  </span>
  
  <div class="font-display text-4xl sm:text-5xl font-bold text-czech-blue mt-2 leading-none">
    {value}
    {unit && <span class="text-lg text-gray-500 font-normal ml-1">{unit}</span>}
  </div>
  
  {description && (
    <p class="text-gray-600 text-sm mt-3">
      {description}
    </p>
  )}
  
  {change !== undefined && (
    <span 
      class:list={[
        'inline-flex items-center gap-1 text-sm font-semibold mt-3 px-2 py-0.5 rounded',
        change >= 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-czech-red'
      ]}
    >
      {change >= 0 ? '↑' : '↓'} {Math.abs(change)}%
    </span>
  )}
  
  {source && (
    <cite class="block text-xs text-gray-400 mt-2 not-italic">
      Zdroj: {source}
    </cite>
  )}
  
  <!-- Chart icon - only show if has details -->
  {hasDetails && (
    <div class="absolute top-3 right-3 text-blue-400 transition-colors">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4v16"/>
      </svg>
    </div>
  )}
</article>